## 02 | TCP 协议：如何保证页面文件能被完整送达浏览器？

> 描述性能的一个重要指标 `FP(First Panit),指从页面加载到首次开始绘制的时长`
> 影响 FP 指标的一个重要因素是`网络加载速度`

### 在网络中，文件被拆分为很多数据包来进行传输，而数据包在传输过程中有很大概率丢失或出错，如何保证页面文件能被完整送达浏览器？

> 互联网：是一套理念和协议组成的体系架构

1. IP:把数据包送达目的主机(不能确定是哪个应用程序)

   > 数据包要在互联网上进行传输，就要符合网际协议（Internet Protocol，简称 ip）,每个在线设备的唯一地址

   > **计算机的地址就称为 ip 地址，访问任何网站实际只是你的计算机向另一台计算机请求信息**
   >
   > [主机 A 向主机 B 发送数据包](/images/简化的 IP 网络三层传输模型.png)
   >
   > - 上层将数据包交给网络层；
   >
   > - 网络层再将 IP 头附加到数据包上，组成新的 IP 数据包，并交给`底层`；
   >
   > - 底层通过物理网络将数据包传输给主机 B；
   >
   > - 数据包被传输到主机 B 的网络层，在这里主机 B 拆开数据包的 IP 头信息，并将拆开来的数据部分交给上层；
   >
   > - 最终，数据包就到达了主机 B 的上层了。

2. UDP：把数据包送达应用程序

   > 用户数据包协议（User Datagram Protocol）UDP
   >
   > IP 通过 IP 地址信息把数据包发送给指定的电脑，而 UDP 通过端口号把数据包分发给正确的程序
   >
   > [主机 A 向主机 B 发送数据包](/images/简化的 UDP 网络四层传输模型.png)
   >
   > - 上层将数据包交给传输层；
   >
   > - 传输层会在数据包前面附加上 UDP 头，组成新的 UDP 数据包，再将新的 UDP 数据包交给网络层；
   >
   > - 网络层再将 IP 头附加到数据包上，组成新的 IP 数据包，并交给底层；
   >
   > - 数据包被传输到主机 B 的网络层，在这里主机 B 拆开 IP 头信息，并将拆开来的数据部分交给传输层；
   >
   > - 在传输层，数据包中的 UDP 头会被拆开，并根据 UDP 中所提供的端口号，把数据部分交给上层的应用程序；
   >
   > - 最终，数据包就旅行到了主机 B 上层应用程序这里

   **缺点**

   - 数据包在传输过程中容易丢失
   - 大文件会被拆分成很多小的数据包来传输，这些小的数据包会经过不同的路由，并在不同的时间到达接收端，而 UDP 协议并不知道如何组装这些数据包，从而把这些数据包还原成完整的文件。

3. TCP:把数据完整地送达应用程序

   **解决UDP的缺陷：**

   - 提供重传机制
   - 引入数据包排序机制，确保乱序的数据包组合成一个完整的文件

   **一个完整的生命周期**
   
   - 建立链接（三次握手建立链接）
   
     > 三次握手，建立客户端与服务端之间的连接，一共需要发送三个数据包确认连接的建立
   
   - 传输数据
   
     > 接收端需要对每个数据包进行确认操作。
     >
     > 1. 接收端收到数据包后，会在一定时间内给发送端发送一个确认数据包，否则，会判断为数据包丢失，触发发送端的重发机制。
     > 2.  同样，一个大的文件在传输过程中会被拆分成很多小的数据包，这些数据包到达接收端后，接收端会按照 TCP 头中的序号为其排序，从而保证组成完整的数据。
   
   - 断开连接（四次挥手，断开连接）

**思考题：你怎么理解 HTTP 和 TCP 的关系？**

HTTP协议和TCP协议都是TCP/IP协议簇的子集。

HTTP协议属于应用层，TCP协议属于传输层，HTTP协议位于TCP协议的上层。

请求方要发送的数据包，在应用层加上HTTP头以后会交给传输层的TCP协议处理，应答方接收到的数据包，在传输层拆掉TCP头以后交给应用层的HTTP协议处理。建立 TCP 连接后会顺序收发数据，请求方和应答方都必须依据 HTTP 规范构建和解析HTTP报文。

`总结`

>- 互联网中的数据是通过数据包来传输的，数据包在传输过程中容易丢失或出错。
>- IP 负责把数据包送达目的主机。
>- UDP 负责把数据包送达具体应用。
>- 而 TCP 保证了数据完整地传输，它的连接可分为三个阶段：建立连接、传输数据和断开连接























