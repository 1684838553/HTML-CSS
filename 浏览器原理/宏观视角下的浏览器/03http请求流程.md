## 03 | HTTP 请求流程：为什么很多站点第二次打开速度会很快？

> HTTP 协议，正是建立在 TCP 连接基础之上的。HTTP 是一种允许浏览器向服务器获取资源的协议，是 Web 的基础，通常由浏览器发起请求，用来获取不同类型的文件，例如 HTML 文件、CSS 文件、JavaScript 文件、图片、视频等

### 为什么通常在第一次访问一个站点时，打开速度很慢，当再次访问这个站点时，速度就很快了？当登录过一个网站之后，下次再访问该站点，就已经处于登录状态了，这是怎么做到的呢？

### 浏览器端发起HTTP请求流程

1. 构建请求

   > 浏览器构建请求行信息（如下所示），构建好后，浏览器准备发起网络请求
   >
   > GET /index.html HTTP1.1

2. 查找缓存

   > 在真正发起网络请求之前，浏览器会先在浏览器缓存中查询是否有要请求的文件

   **浏览器缓存是一种在本地保存资源副本，以供下次请求时直接使用的技术。**当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载。如果缓存查找失败，将会进入网络请求。

   **优点：**

   - 缓解服务器压力，提升性能（获取资源的耗时更短了）
   - 对网站来说，缓存是实现资源快速加载的重要组成部分

3. 准备ip和端口(域名解析)

   > 先理解tcp和http之间的关系，结果image中的TCP 和 HTTP 的关系示意图.png
   >
   > HTTP 的内容是通过 TCP 的传输数据阶段来实现的

   **网络请求第一步做什么？**

   - 建立tcp链接，这一步需要ip和端口，一般来说，我们有url地址，那么我们要做的是域名解析，请求域名对应的ip

   负责把域名和 IP 地址做一一映射关系。这套域名映射为 IP 的系统就叫做“域名系统”，简称 DNS

   浏览器还提供了 DNS 数据缓存服务，如果某个域名已经解析过了，那么浏览器会缓存解析的结果，以供下次查询时直接使用，这样也会减少一次网络请求

4. 等待tcp队列

   **ip和端口都有了，下一步并不能直接建立tcp链接**

   > Chrome 有个机制，同一个域名同时最多只能建立 6 个 TCP 连接，如果在同一个域名下同时有 10 个请求发生，那么其中 4 个请求会进入排队等待状态，直至进行中的请求完成。当然，如果当前请求数量少于 6，会直接进入下一步，建立 TCP 连接。

5. 建立tcp连接

   > 三次握手

6. 发送http请求

   > 一旦建立了 TCP 连接，浏览器就可以和服务器进行通信了。而 HTTP 中的数据正是在这个通信过程中传输的。

### 服务器端处理 HTTP 请求流程

1. 返回请求

   > 服务器处理结束，便可以返回数据给浏览器了。对于无法处理或处理出错的消息，服务器会通过状态码来告诉浏览器它的处理结果

2. 断开连接

   > 通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接

3. 重定向





















