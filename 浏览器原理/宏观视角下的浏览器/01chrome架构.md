## 01 | chrome架构：仅仅打开一个页面，为什么有4个进程？
### 1、浏览器多进程
### 谷歌浏览器打开一个页面需要启动多少进程？4个

> 打开 1 个页面至少需要 1 个网络进程、1 个浏览器进程、1 个 GPU 进程以及 1 个渲染进程，共 4 个；如果打开的页面有运行插件的话，还需要再加上 1 个插件进程。

#### 进程与线程

1. 什么是并行处理
 > 计算机中，并行处理是同一时刻处理多个任务。

计算下面3个表达式，并显示结果
 ```
 A = 1+2
 B = 20/5
 C = 7*8
 ```
=》
拆分成4个任务：1、计算A = 1+2  2、 B = 20/5  3、C = 7*8 4、显示最后的计算结果

- 单线程时，分4步按照顺序分别执行这四个任务
- 多线程时，分两步走，第一步，使用三个线程同时执行前三个任务；第二步，在执行第四步

<font color="red">使用并行处理能大大提升性能</font>

2. 线程 VS 进程
多线程可以并行处理任务，但是 **线程不能单独存在，由进程来启动和管理**

<font color="red"> 什么是进程？</font>

> 一个进程就是一个程序的运行实例
> 启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程。

**线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率**
<font color="red">进程与线程之间4个特点？</font>

> 1. 进程中，任意一个线程出错，都会导致程序的崩溃
> 2. 线程之间共享进程中的数据。线程之间可以对进程的公共数据进行读写操作
> 3. 当一个进程关闭之后，操作系统会回收进程所占用的内存。当一个进程退出时，操作系统会回收该进程所申请的所有资源；即使其中任意线程因为操作不当导致内存泄漏，当进程退出时，这些内存也会被正确回收
> 4. 进程之间的内容相互隔离。一个进程崩溃，不会影响其他进程

3. 单进程浏览器时代

> 单进程浏览器指浏览器的所有功能模块都运行在同一个进程里
> **会出现的问题**
> 1. 不稳定。 早期浏览器需要借助插件来实现一些功能，但一个插件的意外崩溃会引起整个浏览器的崩溃
> 2. 不流畅。 所有页面渲染块，js执行环境，插件都运行在同一个线程里，意味着同一时刻只能有一个模块可以执行。例如，某一时刻，该进程被一段无限循环的代码独占，意味着浏览器没有机会执行其他任务，导致浏览器卡顿
> 3. 不安全。 插件可使用c,c++语言编写，通过插件可获取操作系统的任意资源。如果是恶意插件，会引发安全性问题；页面脚本，通过浏览器漏洞来获取系统权限，做一些非法操作，也会引起安全性问题

4. 多进程浏览器时代

**优点：**

> 1. 解决不稳定的问题。所有进程相互隔离，所以，有一个页面或插件崩溃时，影响的之前页面进程或插件进程，其他进程不受影响
> 2. 解决不流畅问题。js也是运行在渲染进程中，所以，js阻塞了渲染进程，影响到的是当前的渲染页面，不会影响浏览器和其他页面，因为其他页面的脚本是运行在他们自己的渲染进程中的。`解决内存泄漏：关闭一个页面时，整个渲染进程会被关闭，之后该进程所占的内存会被系统回收，这样就解决了内村泄漏的问题`
> 3. 解决安全问题。可以使用`安全沙箱`。<font color="red">可以把沙箱看成是操作系统给进程上了一把锁，沙箱里面的程序可以运行，但是不能在你的硬盘上写入任何数据，也不能在敏感位置读取任何数据，例如你的文档和桌面。Chrome 把插件进程和渲染进程锁在沙箱里面，这样即使在渲染进程或者插件进程里面执行了恶意程序，恶意程序也无法突破沙箱去获取系统权限。</font>

**缺点：**
> 1. 更高的资源占用。每个进程都包含公共基础结构的副本（如js运行环境），意味着浏览器会消耗更多的内存资源
> 2. 更复杂的体系架构。浏览器个模块之间耦合性高，扩展性差

5. **最新的谷歌浏览器架构：1个浏览器主进程，1个GPU进程，1个网络进程，多个渲染进程和多个插件进程**
> - 浏览器主进程：主要负责界面显示，用户交互，子进程管理，同时提供存储等功能
> - 渲染进程：将h5,js，css渲染成可与用户交互的网页，`排版引擎Blink和js引擎V8`都运行在该进程中，默认情况下，谷歌为每个tab页创建一个渲染进程。`出于安全考虑，渲染进程都是运行在沙箱模式下`  
> - GPU进程：初衷是实现3D css效果，目前，网页，ui界面都采用GPU绘制
> - 网络进程： 负责页面网络进程的加载
> - 插件进程： 负责插件的运行，因为插件易崩溃。所以需要插件进程来隔离，确保插件进程崩溃不会对浏览器和页面产生影响

**思考题：回顾浏览器的进化路线，你认为推动浏览器发展的主要动力是什么？**
一个角度来说，最大动力就是chrome的出现。曾经的IE像极了诺基亚，chrome就像是横空出世的iPhone ，当着IE的面告诉IE，浏览器应该这么玩儿。
另一个角度也是互联网的发展需要，人们所需要的不再是只是简单展示个页面的浏览器，需要有复杂的交互，浏览器应该能做更多的事情，这对浏览器的稳定性、以及性能都有了新的要求。所以出来一个性能符合要求的浏览器也是必须的。
还有就是11年后相对规范的es5的出现，再之后es6.7，web能做的事情越来越多了，web工程化，再后来node的出现，前端体系越来越庞大

`总结：`
> 早期浏览器：不稳定（单独进程）不流畅（单独进程）不安全（沙箱）
> 早期多进程架构：主进程 渲染进程 插件进程
> 现代多进程架构：主进程 渲染进程 插件进程 GPU进程 网络进程
> 未来：面向服务架构