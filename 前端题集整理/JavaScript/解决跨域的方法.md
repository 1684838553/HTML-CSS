## 为什么会有跨域问题？怎么解决跨域？

> 浏览器为了安全，产生了同源策略。协议，域名，端口。

### 解决方法

利用script标签具有跨域的特点，设置回调函数

1. 前端先设置好回调函数，并将其作为 url 的参数。

2. 服务端接收到请求后，通过该参数获得回调函数名，并将数据放在参数中将其返回

3. 收到结果后因为是 script 标签，所以浏览器会当做是脚本进行运行，从而达到跨域获取数据的目的

#### JSONP

**前端代码**

```html
<body>
    <script>
       function jsonpCallback(data){
            console.log('获取数据',data)
        }
    </script>
    <script src="http://localhost:3000?callback=jsonpCallback"></script>
</body>
</html>
```

**node.js 服务端代码**
```javascript
var http = require('http')
var url = require('url')

var server = http.createServer()

server.on('request',(req,res)=>{
    const person = {
        name:'terry',
        age:12,
        gender:'meal',
    }
    const callback = url.parse(req.url,true).query.callback
    res.writeHead(200)
    res.end(`${callback}(${JSON.stringify(person)})`)
}).listen(3000,'localhost')
```

#### CORS

CORS 是"跨域资源共享"（Cross-origin resource sharing）它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 ajax 只能同源使用的限制。

**前端代码**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://code.jquery.com/jquery-3.2.1.min.js'></script>
    <title>CORS跨域</title>
</head>
<body>
    <script>
       $.ajax({
           url:'http://localhost:3000',
           success:function(res){
               $('body').text(res)
               console.log(res)
           }
       })
    </script>
</body>
</html>
```

**node.js 服务端代码**
```javascript
var http = require('http')

var server = http.createServer()

server.on('request',(req,res)=>{
    const person = {
        name:'terry',
        age:12,
        gender:'meal',
    }
    res.writeHead(200,{"Access-Control-Allow-Origin":"http://127.0.0.1:5500"})
    res.end(JSON.stringify(person))
}).listen(3000,'127.0.0.1')
```
